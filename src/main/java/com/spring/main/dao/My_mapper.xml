<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC
   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.spring.main.dao.MyDAO">

<select id="login" resultType="String" parameterType="String">
	SELECT pw FROM generalmember WHERE id = #{loginId}
</select>


<select id="myprofile" resultType="com.spring.main.dto.MyDTO" parameterType="String">
	SELECT * FROM generalmember WHERE id = #{loginId}
</select>

<update id="myupdate"  parameterType="String">
		UPDATE generalmember SET name=#{name}
			, phone=#{phone}, email=#{email} WHERE id = #{id}
	</update>
	
	
	
	<update id="resetpw"  parameterType="String">
		UPDATE generalmember SET pw=#{newPw} WHERE id = #{loginId}
	</update>

 


<select id="list" resultType="com.spring.main.dto.MyDTO">
	SELECT * FROM board
</select>


<select id="receiverAllCount" resultType="int" parameterType="String">
	SELECT COUNT(msgidx) FROM msg WHERE receiver = #{param1} AND receivedel = 'n'
</select>

<select id="receiveList" resultType="com.spring.main.dto.MsgDTO">
SELECT msgidx , sender , receiver , content , reg_date, rnum 
    FROM (SELECT msgidx , sender , receiver , reg_date, content,
    ROW_NUMBER() OVER(ORDER BY msgidx DESC)  AS rnum FROM msg  WHERE receiver=#{param3} AND receivedel='n')
    WHERE rnum BETWEEN #{param1} AND #{param2}
</select>

<select id="senderAllCount" resultType="int" parameterType="String">
	SELECT COUNT(msgidx) FROM msg WHERE sender = #{param1} AND senddel = 'n'
</select>

<select id="senderList" resultType="com.spring.main.dto.MsgDTO">
SELECT msgidx , sender , receiver , content , reg_date, rnum 
    FROM (SELECT msgidx , sender , receiver , reg_date, content,
    ROW_NUMBER() OVER(ORDER BY msgidx DESC)  AS rnum FROM msg  WHERE sender=#{param3} AND senddel='n')
    WHERE rnum BETWEEN #{param1} AND #{param2}
</select>

<select id="msgDetail" resultType="com.spring.main.dto.MsgDTO">
	SELECT * FROM msg WHERE msgIdx = #{param1}
</select>

</mapper>